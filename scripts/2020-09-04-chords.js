var convertNote={"Ab":"G#","A":"A","A#":"Bb","B":"B","C":"C","C#":"Db","D":"D","D#":"Eb","E":"E","F":"F","F#":"Gb","G":"G"},unison=0,m2=1,M2=2,m3=3,M3=4,intervals={"Church":[unison,M2,M2,m2,M2,M2,M2],"Harmonic Minor":[unison,M2,m2,M2,M2,m2,m3],"Melodic Minor":[unison,M2,m2,M2,M2,M2,M2]},chordNumbers=["I","II","III","IV","V","VI","VII"],notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"];notes=notes.concat(notes);var flatNotes=["Ab","A","Bb","B","C","Db","D","Eb","E","F","Gb","G"];flatNotes=flatNotes.concat(flatNotes);var flatKeys=['F','Bb','Eb','Ab','Db','Gb','Cb'],major="Major",minor="Minor",diminished="Diminished",augmented="Augmented",churchModes=["Major","Dorian","Phrygian","Lydian","Mixolydian","Minor","Locrian"],hminor=["Harmonic Minor","Locrian #6","Ionian #5","Dorian #4","Phrygian Dominant","Lydian #2","Superlocrian"],mminor=["Melodic Minor","Dorian b2","Lydian Augmented","Lydian Dominant","Mixolydian b6","Aeolian b5","Superlocrian"],getModeList={Church:churchModes,"Harmonic Minor":hminor,"Melodic Minor":mminor},chordNumber=function(num,chordType){switch(chordType){case minor:return num.toLowerCase();case major:return num.toUpperCase();case diminished:return num.toLowerCase()+"&deg;";case augmented:return num.toUpperCase()+"+"};console.log("unknown chord type "+chordType+" corresponding number: "+num);return"Should not happen"},dropWhile=function(f,arr){var i=0;while(i<arr.length&&f(arr[i]))i++;return arr.slice(i)},buildKey=function(note,keyType,modeIndex){var keyIntervals=intervals[keyType],knotes=flatKeys.includes(note)?flatNotes:notes,relatedNote=knotes[knotes.indexOf(note)+12-keyIntervals.slice(0,modeIndex+1).reduce(function(l,r){return l+r},0)],potentialNotes=dropWhile(function(n){return n!==relatedNote},knotes),keyNotes=[],i=0;keyIntervals.forEach(function(interval){i+=interval;keyNotes.push(potentialNotes[i])});i=0;while(i<modeIndex){keyNotes.push(keyNotes.shift());i++};return keyNotes.concat(keyNotes)},isChordHelper=function(expectedIntervals){return function(chord,key){var notesFromRoot=dropWhile(function(note){return note!==chord[0]},flatKeys.includes(key)?flatNotes:notes);return notesFromRoot.indexOf(chord[1])-notesFromRoot.indexOf(chord[0])==expectedIntervals[0]&&notesFromRoot.indexOf(chord[2])-notesFromRoot.indexOf(chord[1])==expectedIntervals[1]}},isMajorChord=isChordHelper([M3,m3]),isMinorChord=isChordHelper([m3,M3]),isDimChord=isChordHelper([m3,m3]),isAugChord=isChordHelper([M3,M3]),chordType=function(chord,key){if(isMajorChord(chord,key)){return major}else if(isMinorChord(chord,key)){return minor}else if(isDimChord(chord,key)){return diminished}else if(isAugChord(chord,key)){return augmented}else{console.log("Unknown chord type for chord: "+chord);return"Should not happen, chord: "+chord}},chordName=function(chord,chordType){switch(chordType){case major:return chord[0];case minor:return chord[0]+"min";case diminished:return chord[0]+"&deg;";case augmented:return chord[0]+"+"};console.log("Unknown chord name for chord: "+chord+" , type: "+chordType);return"Should not happen, chord: "+chord},buildChord=function(root,key){var rootIndex=key.indexOf(root),chord=[key[rootIndex],key[rootIndex+2],key[rootIndex+4]],cType=chordType(chord,key[0]),cName=chordName(chord,cType),chordNum=chordNumbers[rootIndex];return{"name":cName,"chord":chord,"number":chordNumber(chordNum,cType)}},createModeList=function(modeType){var modeList=document.getElementById("modelist"),modes=getModeList[modeType];while(modeList.firstChild)modeList.removeChild(modeList.firstChild);modes.forEach(function(n){var l=document.createElement('option');l.appendChild(document.createTextNode(n));modeList.appendChild(l)});updateProgression()},getModeType=function(){var typeRadios=document.getElementsByName("keytype");for(var i=0;i<typeRadios.length;i++)if(typeRadios[i].checked)return typeRadios[i].value;alert("Something went wrong while determining the key")},updateProgression=function(){var tonic=document.getElementById("tonic").value,modeType=getModeType(),mode=document.getElementById('modelist').value,key=buildKey(tonic,modeType,getModeList[modeType].indexOf(mode));for(var i=0;i<7;i++){var headerId="chordnum"+(i+1),dataId="chord"+(i+1),notesId="notes"+(i+1),chordDetails=buildChord(key[i],key);document.getElementById(headerId).innerHTML=chordDetails["number"];document.getElementById(dataId).innerHTML=chordDetails["name"];document.getElementById(notesId).innerHTML=chordDetails["chord"]}},changeMode=function(mode){var modei=mode-1,modeList=document.getElementById('modelist');modeList.selectedIndex=(modeList.selectedIndex+modei)%7;var note=document.getElementsByTagName('td')[7+modei].innerHTML.split(',')[0];document.getElementById('tonic').value=note;updateProgression()},_headers=document.getElementsByTagName('th'),_loop_1=function(i){var el=_headers[i];el.addEventListener('click',function(event){changeMode(parseInt(el.id[el.id.length-1]))})};for(var i=0;i<_headers.length;i++)_loop_1(i);createModeList(getModeType());updateProgression()